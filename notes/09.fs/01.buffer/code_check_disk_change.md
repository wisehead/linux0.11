#1.check_disk_change

```cpp
/*
 * 该子程序检查一个软盘是否已经被更换，如果已经更换就使高速缓冲中与该软驱
 * 对应的所有缓冲区无效。该子程序相对来说较慢，所以我们要尽量少使用它。
 * 所以仅在执行'mount'或'open'时才调用它。我想这是将速度和实用性相结合的
 * 最好方法。若在操作过程当中更换软盘，会导致数据的丢失，这是咎由自取 :-)
 *
 * 注意！尽管目前该子程序仅用于软盘，以后任何可移动介质的块设备都将使用该
 * 程序，mount/open 操作是不需要知道是否是软盘或其它什么特殊介质的。
 */
//// 检查磁盘是否更换，如果已更换就使对应高速缓冲区无效。

check_disk_change
// 是软盘设备吗？如果不是则退出。
--if (MAJOR(dev) != 2)
----return;
// 测试对应软盘是否已更换，如果没有则退出。
--if (!floppy_change(dev & 0x03))
----return;
// 软盘已经更换，所以释放对应设备的i 节点位图和逻辑块位图所占的高速缓冲区；并使该设备的
// i 节点和数据块信息所占的高速缓冲区无效。
--for (i=0 ; i<NR_SUPER ; i++)
----if (super_block[i].s_dev == dev)
------put_super(super_block[i].s_dev);
--invalidate_inodes(dev);
--invalidate_buffers(dev);
```