#1.sys_unlink

```cpp
//// 系统调用函数- 删除文件名以及可能也删除其相关的文件。
// 从文件系统删除一个名字。如果是一个文件的最后一个连接，并且没有进程正打开该文件，则该文件
// 也将被删除，并释放所占用的设备空间。
// 参数：name - 文件名。
// 返回：成功则返回0，否则返回出错号。

sys_unlink
--dir = dir_namei(name,&namelen,&basename)
// 如果对应路径名上最后的文件名的目录项不存在，则释放包含该目录项的高速缓冲区，释放目录
// 的i 节点，返回文件已经存在出错码，退出。否则dir 是包含要被删除目录名的目录i 节点，de
// 是要被删除目录的目录项结构。
--bh = find_entry(&dir,basename,namelen,&de);
// 取该目录项指明的i 节点。若出错则释放目录的i 节点，并释放含有目录项的高速缓冲区，
// 返回出错号。
--inode = iget(dir->i_dev, de->inode)
// 将该文件名的目录项中的i 节点号字段置为0，表示释放该目录项，并设置包含该目录项的缓冲区                                                 
// 已修改标志，释放该高速缓冲区。                                                                              
--de->inode = 0;                                                                                
--bh->b_dirt = 1;                                                                               
--brelse(bh);                                                                                   
// 该i 节点的连接数减1，置已修改标志，更新改变时间为当前时间。最后释放该i 节点和目录的i 节                                              
// 点，返回0(成功)。                                                                                   
--inode->i_nlinks--;                                                                            
--inode->i_dirt = 1;                                                                            
--inode->i_ctime = CURRENT_TIME;                                                                
--iput(inode);                                                                                  
--iput(dir);                                                                                    
--return 0;                                                                                     

```